<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Tysk Sein Træner</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIlR5c2sgU2VpbiBUcsOmbmVyIiwKICAic2hvcnRfbmFtZSI6ICJTZWluIFRyw6ZuZXIiLAogICJkZXNjcmlwdGlvbiI6ICJMw6ZyIHZlcmJldCAnc2VpbicgcMOlIHR5c2siLAogICJzdGFydF91cmwiOiAiLiIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgInRoZW1lX2NvbG9yIjogIiM2MzY2ZjEiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiNmOWZhZmIiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUIzYVdSMGFEMGlNVEk0SWlCb1pXbG5hSFE5SWpFeU9DSWdkbWxsZDBKdmVEMGlNQ0F3SURFME5DQXhORFFpSUdobGJHNXpQU0pvZEhSd2N6b3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpUGdvOGNtVmpkQ0IzYVdSMGFEMGlNVEkwSWlCb1pXbG5hSFE5SWpFeU5DSWdabWxzYkQwaVl6WXpOalptTVNJZ2NuZzlJakVpTHo0S1BIUmxlSFFnZUQwaU5qUWlJSGs5SWpRMElpQm1iMjUwTFdaaGJXbHNlVDBpYzJGdWN5MXpaWEpwWmlJZ1ptOXVkQzF6YVhwbFBTSXpOaUlnWm1sc2JEMGlZV0Z5WVdGaklpQjBaWGgwTFdGdVkyaHZjajBpYldsa1pHeGxJajVUUEM5MFpYaDBQZ284TDNOMlp6NEsiLAogICAgICAic2l6ZXMiOiAiMTQ0eDEwNCIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9CiAgXQp9">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Sein Træner">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmlld0JveD0iMCAwIDE0NCAxNDQiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMjQiIGhlaWdodD0iMTI0IiBmaWxsPSJjNjM2NmYxIiByeD0iMSIvPgo8dGV4dCB4PSI2NCIgeT0iNDQiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjM2IiBmaWxsPSJhYXJhYWEiIHRleHQtYW5jaG9yPSJtaWRkbGUiPlM8L3RleHQ+Cjwvc3ZnPgo=">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
            -webkit-user-select: none;
            user-select: none;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding-top: 20px;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-header .icon {
            font-size: 24px;
            margin-right: 12px;
        }

        .card-header h2 {
            font-size: 20px;
            font-weight: 600;
            color: #1a202c;
        }

        .conjugation-table {
            display: grid;
            gap: 8px;
            margin-bottom: 15px;
        }

        .conjugation-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            padding: 12px;
            background: #f7fafc;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .pronoun {
            font-weight: 600;
            color: #4a5568;
        }

        .verb {
            font-weight: 700;
            color: #667eea;
        }

        .example-sentence {
            font-size: 22px;
            font-weight: 700;
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
            border-radius: 15px;
            margin-bottom: 15px;
            line-height: 1.4;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        .translation {
            font-size: 16px;
            color: #718096;
            text-align: center;
            padding: 15px;
            background: #f7fafc;
            border-radius: 12px;
            margin-bottom: 15px;
            border: 2px dashed #e2e8f0;
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 15px 20px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-decoration: none;
            -webkit-tap-highlight-color: transparent;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f7fafc;
            color: #4a5568;
            border: 2px solid #e2e8f0;
        }

        .btn-success {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
            box-shadow: 0 4px 15px rgba(72, 187, 120, 0.4);
        }

        .btn-full {
            grid-column: 1 / -1;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }

        .nav-btn {
            padding: 12px 20px;
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-weight: 600;
            color: #4a5568;
            cursor: pointer;
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .nav-btn:not(:disabled):active {
            transform: scale(0.95);
        }

        .progress-indicator {
            text-align: center;
            font-size: 14px;
            color: #718096;
            font-weight: 500;
        }

        .quiz-question {
            font-size: 20px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 25px;
            line-height: 1.5;
            color: #2d3748;
        }

        .quiz-options {
            display: grid;
            gap: 12px;
            margin-bottom: 20px;
        }

        .quiz-option {
            padding: 18px;
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            -webkit-tap-highlight-color: transparent;
        }

        .quiz-option:active {
            transform: scale(0.98);
        }

        .quiz-option.correct {
            background: #c6f6d5;
            border-color: #48bb78;
            color: #22543d;
        }

        .quiz-option.incorrect {
            background: #fed7d7;
            border-color: #e53e3e;
            color: #742a2a;
        }

        .quiz-option.disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .feedback {
            padding: 15px;
            border-radius: 12px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 20px;
        }

        .feedback.correct {
            background: #c6f6d5;
            color: #22543d;
            border: 2px solid #48bb78;
        }

        .feedback.incorrect {
            background: #fed7d7;
            color: #742a2a;
            border: 2px solid #e53e3e;
        }

        .score-display {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 20px;
            margin-bottom: 25px;
        }

        .score-number {
            font-size: 48px;
            font-weight: 700;
            margin: 10px 0;
        }

        .hidden {
            display: none;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-in {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* Install prompt */
        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: #1a202c;
            color: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            z-index: 1000;
            transform: translateY(100px);
            transition: transform 0.3s ease;
        }

        .install-prompt.show {
            transform: translateY(0);
        }

        .install-prompt button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            margin: 5px;
            font-weight: 600;
            cursor: pointer;
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .card {
                padding: 20px;
            }
            
            .example-sentence {
                font-size: 20px;
                padding: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🇩🇪 Tysk Sein Træner</h1>
            <p>Lær verbet "sein" på tysk</p>
        </div>

        <!-- Learning Mode -->
        <div id="learningMode">
            <!-- Conjugation Table -->
            <div class="card">
                <div class="card-header">
                    <span class="icon">📋</span>
                    <h2>Bøjning af verbet 'sein'</h2>
                </div>
                
                <div id="conjugationTable" class="conjugation-table hidden"></div>
                
                <button class="btn btn-secondary btn-full" onclick="toggleConjugation()">
                    <span id="conjugationToggleText">👁️ Vis bøjning</span>
                </button>
            </div>

            <!-- Examples -->
            <div class="card">
                <div class="card-header">
                    <span class="icon">💬</span>
                    <h2>Eksempler</h2>
                </div>
                
                <div id="exampleSentence" class="example-sentence"></div>
                
                <div id="translationDiv" class="translation hidden slide-in"></div>
                
                <div class="button-group">
                    <button class="btn btn-success" onclick="speakSentence()">
                        🔊 Lyt
                    </button>
                    <button class="btn btn-success" onclick="toggleTranslation()">
                        <span id="translationToggleText">👁️ Oversæt</span>
                    </button>
                </div>
                
                <div class="navigation">
                    <button class="nav-btn" id="prevBtn" onclick="previousExample()">
                        ⬅️ Forrige
                    </button>
                    <div class="progress-indicator">
                        <span id="currentIndex">1</span> af <span id="totalExamples">9</span>
                    </div>
                    <button class="nav-btn" id="nextBtn" onclick="nextExample()">
                        Næste ➡️
                    </button>
                </div>
            </div>

            <!-- Start Quiz Button -->
            <button class="btn btn-primary btn-full" onclick="startQuiz()">
                🧠 Start øvelser
            </button>
        </div>

        <!-- Quiz Mode -->
        <div id="quizMode" class="hidden">
            <div class="card">
                <div class="card-header">
                    <span class="icon">❓</span>
                    <h2>Øvelse <span id="questionNumber">1</span> af 5</h2>
                    <div style="margin-left: auto; font-weight: 700; color: #667eea;">
                        Score: <span id="currentScore">0</span>
                    </div>
                </div>
                
                <div id="quizQuestion" class="quiz-question"></div>
                
                <div id="quizOptions" class="quiz-options"></div>
                
                <div id="quizFeedback" class="feedback hidden"></div>
                
                <button id="nextQuestionBtn" class="btn btn-primary btn-full hidden" onclick="nextQuestion()">
                    Næste spørgsmål
                </button>
            </div>
        </div>

        <!-- Results -->
        <div id="resultsMode" class="hidden">
            <div class="card">
                <div class="score-display">
                    <div style="font-size: 60px;">🏆</div>
                    <h2>Øvelsen er færdig!</h2>
                    <div class="score-number" id="finalScore">0</div>
                    <p>ud af 5 spørgsmål</p>
                </div>
                
                <div id="resultMessage" style="text-align: center; font-size: 18px; margin-bottom: 25px; padding: 20px; background: #f7fafc; border-radius: 12px; font-weight: 600;"></div>
                
                <div class="button-group">
                    <button class="btn btn-primary" onclick="restartQuiz()">
                        🔄 Prøv igen
                    </button>
                    <button class="btn btn-secondary" onclick="backToLearning()">
                        📚 Tilbage til træning
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Install Prompt -->
    <div id="installPrompt" class="install-prompt">
        <div>📱 Installer appen på din telefon for den bedste oplevelse!</div>
        <button onclick="installApp()">Installer</button>
        <button onclick="dismissInstallPrompt()">Ikke nu</button>
    </div>

    <script>
        // App data
        const examples = [
            { pronoun: "ich", verb: "bin", german: "Ich bin 14 Jahre alt.", danish: "Jeg er 14 år gammel." },
            { pronoun: "du", verb: "bist", german: "Du bist sehr klug.", danish: "Du er meget klog." },
            { pronoun: "er", verb: "ist", german: "Er ist mein Freund.", danish: "Han er min ven." },
            { pronoun: "sie", verb: "ist", german: "Sie ist meine Schwester.", danish: "Hun er min søster." },
            { pronoun: "es", verb: "ist", german: "Es ist ein Buch.", danish: "Det er en bog." },
            { pronoun: "wir", verb: "sind", german: "Wir sind in der Schule.", danish: "Vi er i skolen." },
            { pronoun: "ihr", verb: "seid", german: "Ihr seid gute Schüler.", danish: "I er gode elever." },
            { pronoun: "sie", verb: "sind", german: "Sie sind aus Deutschland.", danish: "De er fra Tyskland." },
            { pronoun: "Sie", verb: "sind", german: "Sie sind herzlich willkommen.", danish: "De er hjertelig velkommen." }
        ];

        const quizQuestions = [
            { question: "Hvad er den korrekte form af 'sein'?\n\nIch ___ 14 Jahre alt.", options: ["bin", "bist", "ist", "sind"], correct: "bin" },
            { question: "Udfyld den manglende form:\n\nDu ___ sehr klug.", options: ["bin", "bist", "ist", "sind"], correct: "bist" },
            { question: "Hvad er den korrekte form?\n\nWir ___ in der Schule.", options: ["bin", "ist", "sind", "seid"], correct: "sind" },
            { question: "Vælg den rigtige form:\n\nIhr ___ gute Schüler.", options: ["bin", "bist", "seid", "sind"], correct: "seid" },
            { question: "Udfyld sætningen:\n\nSie (høflig form) ___ herzlich willkommen.", options: ["bist", "ist", "seid", "sind"], correct: "sind" }
        ];

        // App state
        let currentExampleIndex = 0;
        let showTranslation = false;
        let showConjugation = false;
        let currentQuestionIndex = 0;
        let score = 0;
        let selectedAnswer = null;

        // PWA install prompt
        let deferredPrompt;
        let installPromptDismissed = localStorage.getItem('installPromptDismissed') === 'true';

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupPWAInstallPrompt();
        });

        function initializeApp() {
            renderConjugationTable();
            updateExample();
            updateNavigationButtons();
        }

        function renderConjugationTable() {
            const table = document.getElementById('conjugationTable');
            table.innerHTML = examples.map(ex => 
                `<div class="conjugation-row">
                    <div class="pronoun">${ex.pronoun}</div>
                    <div class="verb">${ex.verb}</div>
                </div>`
            ).join('');
        }

        function toggleConjugation() {
            const table = document.getElementById('conjugationTable');
            const toggleText = document.getElementById('conjugationToggleText');
            
            showConjugation = !showConjugation;
            
            if (showConjugation) {
                table.classList.remove('hidden');
                table.classList.add('fade-in');
                toggleText.textContent = '🙈 Skjul bøjning';
            } else {
                table.classList.add('hidden');
                toggleText.textContent = '👁️ Vis bøjning';
            }
        }

        function updateExample() {
            const example = examples[currentExampleIndex];
            document.getElementById('exampleSentence').textContent = example.german;
            document.getElementById('currentIndex').textContent = currentExampleIndex + 1;
            document.getElementById('totalExamples').textContent = examples.length;
            
            // Hide translation when switching examples
            if (showTranslation) {
                toggleTranslation();
            }
        }

        function toggleTranslation() {
            const translationDiv = document.getElementById('translationDiv');
            const toggleText = document.getElementById('translationToggleText');
            const example = examples[currentExampleIndex];
            
            showTranslation = !showTranslation;
            
            if (showTranslation) {
                translationDiv.textContent = example.danish;
                translationDiv.classList.remove('hidden');
                translationDiv.classList.add('slide-in');
                toggleText.textContent = '🙈 Skjul';
            } else {
                translationDiv.classList.add('hidden');
                toggleText.textContent = '👁️ Oversæt';
            }
        }

        function speakSentence() {
            const example = examples[currentExampleIndex];
            const btn = event.target.closest('button');
            const originalText = btn.innerHTML;
            
            // Visual feedback
            btn.innerHTML = '🔊 Afspiller...';
            btn.disabled = true;
            btn.style.opacity = '0.7';
            
            // Use Google Translate's audio API for professional German pronunciation
            const audioUrl = `https://translate.google.com/translate_tts?ie=UTF-8&tl=de&client=tw-ob&q=${encodeURIComponent(example.german)}`;
            
            const audio = new Audio();
            audio.crossOrigin = "anonymous";
            
            // Create a proxy URL to avoid CORS issues
            const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(audioUrl)}`;
            
            audio.src = proxyUrl;
            
            audio.onloadstart = function() {
                console.log('Indlæser tysk lyd...');
            };
            
            audio.oncanplay = function() {
                audio.play().catch(err => {
                    console.log('Kunne ikke afspille lyd:', err);
                    // Fallback to local pronunciation guide
                    showPronunciationGuide(example);
                    resetButton();
                });
            };
            
            audio.onended = function() {
                resetButton();
            };
            
            audio.onerror = function() {
                console.log('Lyd fejlede, viser udtale guide');
                showPronunciationGuide(example);
                resetButton();
            };
            
            // Timeout after 5 seconds
            setTimeout(() => {
                if (btn.disabled) {
                    audio.pause();
                    showPronunciationGuide(example);
                    resetButton();
                }
            }, 5000);
            
            function resetButton() {
                btn.innerHTML = originalText;
                btn.disabled = false;
                btn.style.opacity = '1';
            }
        }
        
        function showPronunciationGuide(example) {
            const guide = getDetailedPronunciationGuide(example.german);
            
            // Create a modal-like popup
            const modal = document.createElement('div');
            modal.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 1000; display: flex; align-items: center; justify-content: center; padding: 20px;">
                    <div style="background: white; padding: 30px; border-radius: 20px; max-width: 350px; text-align: center;">
                        <h3 style="color: #333; margin-bottom: 20px;">🎯 Tysk udtale</h3>
                        <div style="background: #f0f8ff; padding: 15px; border-radius: 12px; margin-bottom: 15px;">
                            <strong style="font-size: 18px; color: #2d3748;">${example.german}</strong>
                        </div>
                        <div style="background: #f7fafc; padding: 15px; border-radius: 12px; margin-bottom: 20px; line-height: 1.6;">
                            ${guide}
                        </div>
                        <button onclick="this.parentElement.parentElement.remove()" style="background: #667eea; color: white; border: none; padding: 12px 24px; border-radius: 12px; font-weight: 600; cursor: pointer;">
                            Forstået ✓
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function getDetailedPronunciationGuide(germanText) {
            const guides = {
                'Ich bin 14 Jahre alt.': `
                    <strong>Ich</strong> = "ikh" (som i "ich" men med hårdt k-lyd)<br>
                    <strong>bin</strong> = "bin" (som dansk)<br>
                    <strong>Jahre</strong> = "YA-re" (YA som i "ja", re som i "regel")<br>
                    <strong>alt</strong> = "alt" (som dansk)
                `,
                'Du bist sehr klug.': `
                    <strong>Du</strong> = "du" (som dansk)<br>
                    <strong>bist</strong> = "bist" (som dansk "bist")<br>
                    <strong>sehr</strong> = "zeːr" (z-lyd + langt e)<br>
                    <strong>klug</strong> = "kluk" (som dansk "klug")
                `,
                'Er ist mein Freund.': `
                    <strong>Er</strong> = "eːr" (langt e + r)<br>
                    <strong>ist</strong> = "ist" (som dansk)<br>
                    <strong>mein</strong> = "main" (som engelsk "mine")<br>
                    <strong>Freund</strong> = "froint" (fr + oy-lyd + nt)
                `,
                'Sie ist meine Schwester.': `
                    <strong>Sie</strong> = "ziː" (z-lyd + langt i)<br>
                    <strong>ist</strong> = "ist" (som dansk)<br>
                    <strong>meine</strong> = "mai-ne" (mai + ne)<br>
                    <strong>Schwester</strong> = "SHVES-ter" (sh + ves + ter)
                `,
                'Es ist ein Buch.': `
                    <strong>Es</strong> = "es" (som dansk)<br>
                    <strong>ist</strong> = "ist" (som dansk)<br>
                    <strong>ein</strong> = "ain" (som engelsk "I")<br>
                    <strong>Buch</strong> = "buːkh" (bu + ch-lyd fra baghalsen)
                `,
                'Wir sind in der Schule.': `
                    <strong>Wir</strong> = "viːr" (v + langt i + r)<br>
                    <strong>sind</strong> = "zint" (z + int)<br>
                    <strong>in</strong> = "in" (som dansk)<br>
                    <strong>der</strong> = "deːr" (de + r)<br>
                    <strong>Schule</strong> = "SHU-le" (shu + le)
                `,
                'Ihr seid gute Schüler.': `
                    <strong>Ihr</strong> = "iːr" (langt i + r)<br>
                    <strong>seid</strong> = "zait" (z + ai + t)<br>
                    <strong>gute</strong> = "GU-te" (gu + te)<br>
                    <strong>Schüler</strong> = "SHOY-ler" (sh + øy + ler)
                `,
                'Sie sind aus Deutschland.': `
                    <strong>Sie</strong> = "ziː" (z + langt i)<br>
                    <strong>sind</strong> = "zint" (z + int)<br>
                    <strong>aus</strong> = "aus" (au som i "hau")<br>
                    <strong>Deutschland</strong> = "DOITSH-lant" (doitsh + lant)
                `,
                'Sie sind herzlich willkommen.': `
                    <strong>Sie</strong> = "ziː" (z + langt i)<br>
                    <strong>sind</strong> = "zint" (z + int)<br>
                    <strong>herzlich</strong> = "HERTS-likh" (herts + likh)<br>
                    <strong>willkommen</strong> = "vil-KOM-men" (vil + kom + men)
                `
            };
            
            return guides[germanText] || `
                <em>Udtale guide ikke tilgængelig for denne sætning.</em><br>
                <strong>Tip:</strong> Husk at tysk har hårdere konsonanter og klarere vokaler end dansk.
            `;
        }
        
        function getPhoneticGuide(germanText) {
            const pronunciationMap = {
                'Ich bin': 'Ikh bin',
                'Du bist': 'Du bist',
                'Er ist': 'Ær ist',
                'Sie ist': 'Zi ist',
                'Es ist': 'Es ist',
                'Wir sind': 'Vir zind',
                'Ihr seid': 'Ær zaid',
                'Sie sind': 'Zi zind',
                'Jahre': 'YA-re',
                'alt': 'alt',
                'sehr': 'zær',
                'klug': 'klug',
                'mein': 'main',
                'Freund': 'froind',
                'meine': 'mai-ne',
                'Schwester': 'SHVES-ter',
                'ein': 'ain',
                'Buch': 'bukh',
                'in': 'in',
                'der': 'dær',
                'Schule': 'SHU-le',
                'gute': 'GU-te',
                'Schüler': 'SHOY-ler',
                'aus': 'ous',
                'Deutschland': 'DOITSH-land',
                'herzlich': 'HÆRTS-likh',
                'willkommen': 'vil-KOM-men'
            };
            
            let phonetic = germanText;
            for (let [german, pronunciation] of Object.entries(pronunciationMap)) {
                phonetic = phonetic.replace(new RegExp(german, 'gi'), pronunciation);
            }
            
            return `Udtale: ${phonetic}`;
        }
        
        // Initialize voices when they're loaded
        function initializeVoices() {
            if (window.speechSynthesis.getVoices().length === 0) {
                window.speechSynthesis.addEventListener('voiceschanged', function() {
                    console.log('Stemmer indlæst:', window.speechSynthesis.getVoices().length);
                });
            }
        }
        
        // Call voice initialization
        setTimeout(initializeVoices, 100);

        function previousExample() {
            if (currentExampleIndex > 0) {
                currentExampleIndex--;
                updateExample();
                updateNavigationButtons();
            }
        }

        function nextExample() {
            if (currentExampleIndex < examples.length - 1) {
                currentExampleIndex++;
                updateExample();
                updateNavigationButtons();
            }
        }

        function updateNavigationButtons() {
            document.getElementById('prevBtn').disabled = currentExampleIndex === 0;
            document.getElementById('nextBtn').disabled = currentExampleIndex === examples.length - 1;
        }

        function startQuiz() {
            document.getElementById('learningMode').classList.add('hidden');
            document.getElementById('quizMode').classList.remove('hidden');
            document.getElementById('quizMode').classList.add('fade-in');
            
            currentQuestionIndex = 0;
            score = 0;
            updateQuizQuestion();
        }

        function updateQuizQuestion() {
            const question = quizQuestions[currentQuestionIndex];
            
            document.getElementById('questionNumber').textContent = currentQuestionIndex + 1;
            document.getElementById('currentScore').textContent = score;
            document.getElementById('quizQuestion').textContent = question.question;
            
            const optionsContainer = document.getElementById('quizOptions');
            optionsContainer.innerHTML = question.options.map(option => 
                `<div class="quiz-option" onclick="selectAnswer('${option}')">${option}</div>`
            ).join('');
            
            // Reset feedback and next button
            document.getElementById('quizFeedback').classList.add('hidden');
            document.getElementById('nextQuestionBtn').classList.add('hidden');
            selectedAnswer = null;
        }

        function selectAnswer(answer) {
            if (selectedAnswer) return; // Prevent multiple selections
            
            selectedAnswer = answer;
            const question = quizQuestions[currentQuestionIndex];
            const isCorrect = answer === question.correct;
            
            if (isCorrect) {
                score++;
                document.getElementById('currentScore').textContent = score;
            }
            
            // Update option appearances
            const options = document.querySelectorAll('.quiz-option');
            options.forEach(option => {
                option.classList.add('disabled');
                const optionText = option.textContent;
                
                if (optionText === answer) {
                    option.classList.add(isCorrect ? 'correct' : 'incorrect');
                } else if (optionText === question.correct) {
                    option.classList.add('correct');
                }
            });
            
            // Show feedback
            const feedback = document.getElementById('quizFeedback');
            feedback.textContent = isCorrect ? 
                'Korrekt! 🎉' : 
                `Ikke korrekt. Det rigtige svar er: ${question.correct}`;
            feedback.className = `feedback ${isCorrect ? 'correct' : 'incorrect'}`;
            feedback.classList.remove('hidden');
            feedback.classList.add('fade-in');
            
            // Show next button
            const nextBtn = document.getElementById('nextQuestionBtn');
            if (currentQuestionIndex < quizQuestions.length - 1) {
                nextBtn.textContent = 'Næste spørgsmål';
                nextBtn.onclick = nextQuestion;
            } else {
                nextBtn.textContent = 'Se resultat';
                nextBtn.onclick = showResults;
            }
            nextBtn.classList.remove('hidden');
            nextBtn.classList.add('fade-in');
            
            // Haptic feedback simulation
            if (navigator.vibrate) {
                navigator.vibrate(isCorrect ? [50] : [100, 50, 100]);
            }
        }

        function nextQuestion() {
            currentQuestionIndex++;
            updateQuizQuestion();
        }

        function showResults() {
            document.getElementById('quizMode').classList.add('hidden');
            document.getElementById('resultsMode').classList.remove('hidden');
            document.getElementById('resultsMode').classList.add('fade-in');
            
            document.getElementById('finalScore').textContent = score;
            
            const resultMessage = document.getElementById('resultMessage');
            if (score === quizQuestions.length) {
                resultMessage.innerHTML = "🎉 Perfekt! Du er en mester i verbet 'sein'!";
            } else if (score >= 3) {
                resultMessage.innerHTML = "👍 Godt klaret! Fortsæt med at øve dig.";
            } else {
                resultMessage.innerHTML = "📚 Øv dig lidt mere og prøv igen!";
            }
        }

        function restartQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            document.getElementById('resultsMode').classList.add('hidden');
            document.getElementById('quizMode').classList.remove('hidden');
            updateQuizQuestion();
        }

        function backToLearning() {
            document.getElementById('resultsMode').classList.add('hidden');
            document.getElementById('learningMode').classList.remove('hidden');
            document.getElementById('learningMode').classList.add('fade-in');
        }

        // PWA Installation
        function setupPWAInstallPrompt() {
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                
                if (!installPromptDismissed) {
                    setTimeout(() => {
                        document.getElementById('installPrompt').classList.add('show');
                    }, 3000);
                }
            });

            window.addEventListener('appinstalled', () => {
                console.log('PWA blev installeret');
                document.getElementById('installPrompt').classList.remove('show');
            });
        }

        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('Brugeren accepterede installationen');
                    }
                    deferredPrompt = null;
                });
            }
            document.getElementById('installPrompt').classList.remove('show');
        }

        function dismissInstallPrompt() {
            document.getElementById('installPrompt').classList.remove('show');
            localStorage.setItem('installPromptDismissed', 'true');
        }

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('data:text/javascript;base64,Ly8gU2VydmljZSBXb3JrZXIgZm9yIFBXQQpjb25zdCBDQUNIRV9OQU1FID0gJ3R5c2stc2Vpbi10cmFlbmVyLXYxJzsKY29uc3QgdXJsc1RvQ2FjaGUgPSBbCiAgJy4vJywKICAnLi9pbmRleC5odG1sJwpdOwoKc2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZnVuY3Rpb24oZXZlbnQpIHsKICBldmVudC53YWl0VW50aWwoCiAgICBjYWNoZXMub3BlbihDQUNIRV9OQU1FKQogICAgICAudGhlbihmdW5jdGlvbihjYWNoZSkgewogICAgICAgIHJldHVybiBjYWNoZS5hZGRBbGwodXJsc1RvQ2FjaGUpOwogICAgICB9KQogICk7Cn0pOwoKc2VsZi5hZGRFdmVudExpc3RlbmVyKCdmZXRjaCcsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgZXZlbnQucmVzcG9uZFdpdGgoCiAgICBjYWNoZXMubWF0Y2goZXZlbnQucmVxdWVzdCkKICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICBpZiAocmVzcG9uc2UpIHsKICAgICAgICAgIHJldHVybiByZXNwb25zZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZldGNoKGV2ZW50LnJlcXVlc3QpOwogICAgICB9KQogICk7Cn0pOw==')
                .then(function(registration) {
                    console.log('ServiceWorker registreret:', registration.scope);
                }, function(err) {
                    console.log('ServiceWorker registrering fejlede:', err);
                });
            });
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'ArrowLeft' && !document.getElementById('learningMode').classList.contains('hidden')) {
                previousExample();
            } else if (e.key === 'ArrowRight' && !document.getElementById('learningMode').classList.contains('hidden')) {
                nextExample();
            } else if (e.key === ' ' && !document.getElementById('learningMode').classList.contains('hidden')) {
                e.preventDefault();
                speakSentence();
            }
        });

        // Touch gestures for better mobile experience
        let touchStartX = null;
        let touchStartY = null;

        document.addEventListener('touchstart', function(e) {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        });

        document.addEventListener('touchend', function(e) {
            if (!touchStartX || !touchStartY) return;

            let touchEndX = e.changedTouches[0].clientX;
            let touchEndY = e.changedTouches[0].clientY;

            let diffX = touchStartX - touchEndX;
            let diffY = touchStartY - touchEndY;

            // Only trigger swipe if horizontal movement is greater than vertical
            if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
                if (!document.getElementById('learningMode').classList.contains('hidden')) {
                    if (diffX > 0) {
                        // Swipe left - next example
                        nextExample();
                    } else {
                        // Swipe right - previous example
                        previousExample();
                    }
                }
            }

            touchStartX = null;
            touchStartY = null;
        });

        // Prevent zoom on double tap
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            let now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        // Update app badge (if supported)
        function updateAppBadge(count) {
            if ('setAppBadge' in navigator) {
                navigator.setAppBadge(count);
            }
        }

        // Wake lock to prevent screen from turning off during use
        let wakeLock = null;

        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                }
            } catch (err) {
                console.log('Wake lock fejlede:', err);
            }
        }

        // Request wake lock when starting quiz
        function startQuizWithWakeLock() {
            startQuiz();
            requestWakeLock();
        }

        // Release wake lock when leaving quiz
        function backToLearningWithWakeLockRelease() {
            backToLearning();
            if (wakeLock) {
                wakeLock.release();
                wakeLock = null;
            }
        }

        // Update button onclick for wake lock
        setTimeout(() => {
            const startQuizBtn = document.querySelector('.btn.btn-primary.btn-full');
            if (startQuizBtn) {
                startQuizBtn.onclick = startQuizWithWakeLock;
            }
        }, 100);
    </script>
</body>
</html>
